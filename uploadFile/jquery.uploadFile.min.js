(function(d,g){function h(a,d,b){var e,c,f=function(a){c=new Image;c.src=e;c.id="imgTmp";c.onload=function(){b&&b(c)}};"undefined"!==typeof FileReader?(d=new FileReader,d.onload=function(a){a=a||g.event;e=(a.target||a.srcElement).result;f(e)},d.readAsDataURL(a)):"undefined"!==typeof URL?(e=g.URL.createObjectURL(a.files[0]),f(e)):(a.select(),e=document.selection.createRange().text,d.innerHTML="",d.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled='true',sizingMethod='scale',src=\""+e+'")',b&&b(d))}function l(a){if(/^\d+$/g.test(a))return a;a=a.toUpperCase().replace(/([B|K|M|G|T])/g,",$1");a=a.split(",");return a[0]*{B:1,K:1024,M:1048576,G:1073741824,T:1099511627776}[a[1]]}var m={doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",xls:"application/vnd.ms-excel",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",pdf:"application/pdf",zip:"application/zip",xml:"application/xml",js:"application/javascript",json:"application/json",txt:"text/plain",html:"text/html",css:"text/css",jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",gif:"image/gif",bmp:"image/bmp",webp:"image/webp",ico:"image/x-icon","img*":"image/*"};d.fn.extend({uploadFile:function(a){var k=this[0],b,e={},c=!1;try{if("string"!==typeof a.url||"string"!==typeof a.btn)throw"url\u6216btn\u53c2\u6570\u9519\u8bef";a.accept&&0<a.accept.length&&(k.accept=a.accept.map(function(a,c){return m[a]||""}).join(","));this.on("change",function(f){f=f||g.event;b=(f.target||f.srcElement).files[0];if("function"===typeof a.onFileChange)a.onFileChange(b);if(b){c=!0;if(a.accept)if(a.accept=a.accept.map(function(a,c,d){"img*"===a&&(a="image");return"jpeg"==a?"jpg":a}),(new RegExp("\\.("+a.accept.join("|")+")$","g")).test(b.name))c=!0;else if(c=!1,-1!==b.type.indexOf("image")&&-1!==a.accept.indexOf("image")&&(c=!0),!c)return a.acceptError&&a.acceptError(),!1;if(0==b.size)return a.sizeError&&a.sizeError(0),c=!1;if(a.maxSize){if(b.size>l(a.maxSize))return a.sizeError&&a.sizeError(1),c=!1;c=!0}c&&a.previewBox&&h(b,d(a.previewBox).get(0),function(b){if(a.scale&&2==a.scale.length)if(b.width>=a.scale[0]&&b.height>=a.scale[1]&&b.height<=d(g).height())c=!0,d(a.previewBox).html(""),d(a.previewBox).append(b),a.previewCallBack&&a.previewCallBack(b,e);else return a.scaleError&&a.scaleError(),c=!1;else d(a.previewBox).html(""),d(a.previewBox).append(b),a.previewCallBack&&a.previewCallBack(b,e)})}else b=null,c=!1});d(a.btn).on("click",function(){var f=!0,g=new FormData;"function"===typeof a.onBeforeSend&&(f=a.onBeforeSend(e));if(f){if(a.data&&0<Object.keys(a.data).length)for(key in a.data)g.append(key,a.data[key]);if(e&&0<Object.keys(e).length)for(key in e)g.append(key,e[key]);if(c)g.append("file",b);else if("function"===typeof a.sendNull)return a.sendNull();d.ajax({url:a.url,method:"POST",data:g,processData:!1,contentType:!1,success:function(b,d,e){c=!1;a.ajaxSuccess&&a.ajaxSuccess(b)},error:function(b,c,d){a.ajaxError&&a.ajaxError(d)}})}})}catch(f){console.error(Error("\u6709\u9519\u8bef\uff01\uff01\uff01 "+f))}return this}})})(jQuery,window);